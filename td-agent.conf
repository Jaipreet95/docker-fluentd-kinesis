<match fluent.**>
  @type null
</match>

<source>
  @type tail
  path /var/log/containers/*.log
  pos_file /var/log/fluent-containers.log.pos
  time_format %Y-%m-%dT%H:%M:%S
  tag kubernetes.*
  format json
  read_from_head true
  enable_watch_timer false
</source>

#<filter kubernetes.**>
#  @type kubernetes_metadata
#</filter>

<match **>
  # plugin type
  @type kinesis_streams

  # AWS credentials
  aws_key_id "#{ENV["AWS_KEY_ID"]}"
  aws_sec_key "#{ENV["AWS_SECRET_KEY"]}"

  # your kinesis stream name
  stream_name "#{ENV["KINESIS_STREAM_NAME"]}"

  # AWS region
  region "#{ENV["AWS_REGION"]}"

  # Use random value for the partition key
  random_partition_key true

  # Frequency of ingestion
  flush_interval 5s

  # Parallelism of ingestion
  num_threads 16
</match>

